# SQL ะะธะณัะฐัะธะธ ะดะปั Backend REST API

## ๐ ะกัััะบัััะฐ

```
sql/
โโโ install_all.sql           # ะะพะปะฝะฐั ัััะฐะฝะพะฒะบะฐ ะฒัะตั ะผะพะดัะปะตะน (ัะตะบะพะผะตะฝะดัะตััั)
โโโ identity/                 # ะะพะดัะปั Identity (ะฐััะตะฝัะธัะธะบะฐัะธั)
โ   โโโ install.sql          # ะฃััะฐะฝะพะฒะบะฐ ะผะพะดัะปั Identity
โ   โโโ identity_users.sql   # ะขะฐะฑะปะธัะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
โ   โโโ identity_session.sql # ะขะฐะฑะปะธัะฐ ัะตััะธะน (JWT)
โโโ reference/                # ะะพะดัะปั Reference (ัะฟัะฐะฒะพัะฝะธะบะธ)
โ   โโโ ref_country.sql      # ะกะฟัะฐะฒะพัะฝะธะบ ัััะฐะฝ
โโโ storage/                  # ะะพะดัะปั Storage (ัะฐะนะปั)
    โโโ storage_files.sql    # ะขะฐะฑะปะธัะฐ ัะฐะนะปะพะฒ
```

---

## ๐ ะััััะฐั ัััะฐะฝะพะฒะบะฐ

### ะะฐัะธะฐะฝั 1: ะฃััะฐะฝะพะฒะบะฐ ะฒัะตั ะผะพะดัะปะตะน ััะฐะทั (ัะตะบะพะผะตะฝะดัะตััั)

```bash
mysql -u cv82602_slimdev -p cv82602_slimdev < sql/install_all.sql
```

ะญัะพั ัะฐะนะป ัะพะทะดะฐัั ะฒัะต ัะฐะฑะปะธัั ะดะปั ะฒัะตั ะผะพะดัะปะตะน + ะดะพะฑะฐะฒะธั ัะตััะพะฒัะต ะดะฐะฝะฝัะต ะดะปั ัะฟัะฐะฒะพัะฝะธะบะฐ ัััะฐะฝ.

---

### ะะฐัะธะฐะฝั 2: ะฃััะฐะฝะพะฒะบะฐ ะผะพะดัะปะตะน ะฟะพ ะพัะดะตะปัะฝะพััะธ

#### ะะพะดัะปั Identity

```bash
# ะะฐัะธะฐะฝั A: ะงะตัะตะท ะพะฑัะธะน ัะฐะนะป
mysql -u cv82602_slimdev -p cv82602_slimdev < sql/identity/install.sql

# ะะฐัะธะฐะฝั B: ะะพ ัะฐะนะปะฐะผ
mysql -u cv82602_slimdev -p cv82602_slimdev < sql/identity/identity_users.sql
mysql -u cv82602_slimdev -p cv82602_slimdev < sql/identity/identity_session.sql
```

#### ะะพะดัะปั Reference

```bash
mysql -u cv82602_slimdev -p cv82602_slimdev < sql/reference/ref_country.sql
```

#### ะะพะดัะปั Storage

```bash
mysql -u cv82602_slimdev -p cv82602_slimdev < sql/storage/storage_files.sql
```

---

## ๐ ะขะฐะฑะปะธัั

### 1. Identity Module

#### `identity_users`
- ะะพะปัะทะพะฒะฐัะตะปะธ ัะธััะตะผั
- ะะพะปั: id, login, pass_hash, access_level, created_at, updated_at

#### `identity_session`
- JWT ัะตััะธะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะะพะปั: id, user_id, access_token, refresh_token, expiresIn, client_id, secret_key, created_at, updated_at

---

### 2. Reference Module

#### `ref_country`
- ะกะฟัะฐะฒะพัะฝะธะบ ัััะฐะฝ
- ะะพะปั: id, uuid, parent_uuid, is_catalog, code, name, sort_order, created_at, updated_at
- ะะพะดะดะตัะถะธะฒะฐะตั ะธะตัะฐััะธัะตัะบัั ััััะบัััั

---

### 3. Storage Module

#### `storage_files`
- ะะตัะฐะดะฐะฝะฝัะต ะทะฐะณััะถะตะฝะฝัั ัะฐะนะปะพะฒ
- ะะพะปั: id, uuid, original_name, storage_name, mime_type, size, path, created_at, updated_at

---

## ๐ง ะฃััะฐะฝะพะฒะบะฐ ัะตัะตะท phpMyAdmin

ะัะปะธ ะฝะตั ะดะพัััะฟะฐ ะบ SSH:

1. ะะพะนะดะธัะต ะฒ phpMyAdmin
2. ะัะฑะตัะธัะต ะฑะฐะทั ะดะฐะฝะฝัั `cv82602_slimdev`
3. ะะตัะตะนะดะธัะต ะฝะฐ ะฒะบะปะฐะดะบั **SQL**
4. ะกะบะพะฟะธััะนัะต ัะพะดะตัะถะธะผะพะต ัะฐะนะปะฐ `sql/install_all.sql`
5. ะััะฐะฒััะต ะฒ ัะตะบััะพะฒะพะต ะฟะพะปะต ะธ ะฝะฐะถะผะธัะต **ะัะฟะพะปะฝะธัั**

---

## โ ะัะพะฒะตัะบะฐ ัััะฐะฝะพะฒะบะธ

ะะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั ะผะธะณัะฐัะธะน ะฟัะพะฒะตัััะต:

```sql
-- ะกะฟะธัะพะบ ะฒัะตั ัะฐะฑะปะธั
SHOW TABLES;

-- ะะพะปะถะฝั ะฑััั:
-- identity_users
-- identity_session
-- ref_country
-- storage_files

-- ะัะพะฒะตัะบะฐ ััััะบัััั
DESCRIBE identity_users;
DESCRIBE identity_session;
DESCRIBE ref_country;
DESCRIBE storage_files;

-- ะัะพะฒะตัะบะฐ ัะตััะพะฒัั ะดะฐะฝะฝัั
SELECT * FROM ref_country;
```

---

## ๐๏ธ ะฃะดะฐะปะตะฝะธะต ัะฐะฑะปะธั (ะตัะปะธ ะฝัะถะฝะพ ะฟะตัะตัััะฐะฝะพะฒะธัั)

**โ๏ธ ะะะะะะะะ: ะญัะพ ัะดะฐะปะธั ะฒัะต ะดะฐะฝะฝัะต!**

```sql
-- ะฃะดะฐะปะตะฝะธะต ะฒัะตั ัะฐะฑะปะธั ะผะพะดัะปะตะน
DROP TABLE IF EXISTS `identity_session`;
DROP TABLE IF EXISTS `identity_users`;
DROP TABLE IF EXISTS `ref_country`;
DROP TABLE IF EXISTS `storage_files`;
```

ะะพัะปะต ัะดะฐะปะตะฝะธั ะผะพะถะฝะพ ะทะฐะฝะพะฒะพ ะฒัะฟะพะปะฝะธัั `sql/install_all.sql`.

---

## ๐ ะัะธะผะตัะฐะฝะธั

1. ะัะต ัะฐะฑะปะธัั ะธัะฟะพะปัะทััั ะบะพะดะธัะพะฒะบั `utf8mb4` (ะฟะพะดะดะตัะถะบะฐ emoji ะธ ัะฟะตััะธะผะฒะพะปะพะฒ)
2. ะัะต ัะฐะฑะปะธัั ะธัะฟะพะปัะทััั ะดะฒะธะถะพะบ `InnoDB` (ะฟะพะดะดะตัะถะบะฐ ััะฐะฝะทะฐะบัะธะน ะธ ะฒะฝะตัะฝะธั ะบะปััะตะน)
3. ะัะฟะพะปัะทััััั `IF NOT EXISTS` - ะฑะตะทะพะฟะฐัะฝะพ ะฒัะฟะพะปะฝััั ะฟะพะฒัะพัะฝะพ
4. ะะฝะดะตะบัั ัะพะทะดะฐะฝั ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ัะฐัััั ะทะฐะฟัะพัะพะฒ

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- ะะฐัะพะปะธ ััะฐะฝัััั ะฒ ะฒะธะดะต bcrypt-ัะตัะตะน (ะฟะพะปะต `pass_hash`)
- JWT ัะพะบะตะฝั ััะฐะฝัััั ะฒ ัะฐะฑะปะธัะต `identity_session`
- ะคะฐะนะปั ััะฐะฝัััั ะฒะฝะต ะดะธัะตะบัะพัะธะธ `public_html`

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะพ

ะะพัะปะต ัััะฐะฝะพะฒะบะธ ัะฐะฑะปะธั:

1. ะัะพะฒะตัััะต API ัะตัะตะท Swagger UI: `https://tradeapp.xsdk.ru/swagger-ui.html`
2. ะะฐัะตะณะธัััะธััะนัะต ัะตััะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ัะตัะตะท `POST /identity/registration`
3. ะะพะฑะฐะฒััะต ัััะฐะฝั ัะตัะตะท `POST /reference/country` (ะธะปะธ ะธัะฟะพะปัะทัะนัะต ะฟัะตะดัััะฐะฝะพะฒะปะตะฝะฝัะต)
4. ะะฐะณััะทะธัะต ัะตััะพะฒัะน ัะฐะนะป ัะตัะตะท `POST /storage/files`
